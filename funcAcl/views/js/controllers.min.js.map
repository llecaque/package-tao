{"version":3,"file":"routes.js","sources":["routes.js","acl.js"],"names":[],"mappings":"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","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n * \n * \n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('funcAcl/controller/routes',[],function(){\n    'use strict';\n\n    return {\n        'Admin' : {\n            'actions' : {\n                'index': 'controller/acl'\n            }\n        }\n    };\n});\n\n","define('funcAcl/controller/acl',['jquery', 'context', 'i18n'], function($, context, __){\n    \n    $.fn.acldata = function(key, val){\n            if (typeof val !== 'undefined'){\n                    $.expr.attrHandle[key] = function(elem){\n                            return $(elem).attr(key) || $(elem).data(key);\n                    };\n            }\n            return $.fn.data.apply(this, arguments);\n    };\n    \n    function loadModules(role, successCallback) {\n\t$('#aclModules ul.group-list').empty();\n\t$('#aclActions ul.group-list').empty();\n\tif (role === '') return;\n\n\t$.ajax({\n\t\ttype: \"POST\",\n\t\turl: context.root_url + \"funcAcl/Admin/getModules\",\n\t\tdata: 'role='+role,\n\t\tdataType: 'json',\n\t\tsuccess: function(data) {\n\t\t\tfor (var e in data) {\n\t\t\t\tvar ext = data[e];\n\t\t\t\tvar extra = '';\n\t\t\t\tif (ext['has-access']) {\n\t\t\t\t\textra = ' has-access';\n\t\t\t\t}\n\t\t\t\telse if (ext['has-allaccess']) {\n\t\t\t\t\textra = ' has-allaccess';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar groupCheckboxTitle = (ext['has-access'] || ext['has-allaccess']) ? __('Revoke access rights to the entire extension') : __('Grant access rights to the entire extension');\n\t\t\t\t\n\t\t\t\tvar $group = $('<li class=\"group expendable closed'+extra+'\"><div class=\"group-title\"><span class=\"ui-icon ui-icon-triangle-1-e\"/><span class=\"title\">'+ e +'</span><span class=\"selector all checkable\" title=\"' + groupCheckboxTitle + '\"></span></div><ul></ul></li>');\n\t\t\t\t$group.acldata('uri', ext.uri);\n\t\t\t\tif (ext['has-access'] == true){\n\t\t\t\t\t$('.selector', $group).click(function (e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tAccess2None($(this))\n\t\t\t\t\t});\t\n\t\t\t\t}\n\t\t\t\telse if (ext['has-allaccess'] == true){\n\t\t\t\t\t$('.selector', $group).click(function (e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tAccess2None($(this))\n\t\t\t\t\t});\n\t\t\t\t} \n\t\t\t\telse {\n\t\t\t\t\t$('.selector', $group).click(function (e) {e.stopPropagation();Access2All($(this))});\t\n\t\t\t\t}\n\t\t\t\t//Open/close group\n\t\t\t\t$('.group-title', $group).click(function(e) {\n\t\t\t\t\tif ($(this).parent().hasClass('open')){\n\t\t\t\t\t\t$(this).removeClass('open');\n\t\t\t\t\t\t$(this).parent().removeClass('open').addClass('closed');\n\t\t\t\t\t\t$(this).find('.ui-icon').removeClass('ui-icon-triangle-1-s').addClass('ui-icon-triangle-1-e');\n\t\t\t\t\t\t$(this).parent().find('.selected').removeClass('selected');\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t$(this).addClass('open');\n\t\t\t\t\t\t$(this).parent().removeClass('closed').addClass('open');\n\t\t\t\t\t\t$(this).find('.ui-icon').removeClass('ui-icon-triangle-1-e').addClass('ui-icon-triangle-1-s');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tfor (var m in ext.modules) {\n\t\t\t\t\tvar mod = ext.modules[m];\n\t\t\t\t\tvar extra = '';\n\t\t\t\t\tif (mod['has-access']){\n\t\t\t\t\t\textra = ' has-access';\n\t\t\t\t\t}\n\t\t\t\t\telse if (mod['has-allaccess']){\n\t\t\t\t\t\textra = ' has-allaccess';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar modCheckboxTitle = (mod['has-access'] || mod['has-allaccess']) ? __('Revoke access rights to the entire module') : __('Grant access rights to the entire module');\n\t\t\t\t\t\n\t\t\t\t\tvar $el = $('<li class=\"selectable'+extra+'\"><span class=\"label\">'+ m +'</span><span class=\"selector checkable\" title=\"'+ modCheckboxTitle +'\"></span></li>');\n\t\t\t\t\t$el.acldata('uri', mod.uri);\n\t\t\t\t\tif (mod['has-access']) $('.selector', $el).click(function (e) {e.stopPropagation();Access2All($(this))});\n\t\t\t\t\telse if (mod['has-allaccess']) $('.selector', $el).click(function (e) {e.stopPropagation();Access2None($(this))});\n\t\t\t\t\telse $('.selector', $el).click(function (e) {e.stopPropagation();Access2All($(this))});\n\t\t\t\t\t//Select module\n\t\t\t\t\t$el.click(function() {\n\t\t\t\t\t\t$('#aclModules .selectable').removeClass('selected');\n\t\t\t\t\t\t$(this).addClass('selected');\n\t\t\t\t\t\tloadActions($('#roles').val(), $(this).acldata('uri'));\n\t\t\t\t\t});\n\t\t\t\t\t$el.appendTo($('ul', $group));\n\t\t\t\t}\n\t\t\t\t$group.appendTo($('#aclModules ul.group-list'));\n\t\t\t}\n\t\t\t\n\t\t\tif (typeof successCallback != 'undefined'){\n\t\t\t\tsuccessCallback();\n\t\t\t}\n\t\t}\n\t});\n    }\n\n    function loadActions(role, module, successCallback) {\n\t$.ajax({\n\t\ttype: \"POST\",\n\t\turl: context.root_url + \"funcAcl/Admin/getActions\",\n\t\tdata: 'role='+role+'&module='+module,\n\t\tdataType: 'json',\n\t\tsuccess: function(data) {\n\t\t\t$('#aclActions ul.group-list').empty();\n\t\t\tvar nballaccess = 0;\n\t\t\tfor (e in data) {\n\t\t\t\tvar act = data[e];\n\t\t\t\tvar extra = '';\n\n\t\t\t\tif (act['has-allaccess'] || act['has-access']) {\n\t\t\t\t\textra = ' has-allaccess';\n\t\t\t\t\tnballaccess++;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar actCheckBoxTitle = (extra === ' has-allaccess') ? __('Revoke access rights to the action') : __('Grant access rights to the action');\n\t\t\t\t\n\t\t\t\tvar $el = $('<li class=\"selectable'+extra+'\"><span class=\"label\">'+ e +'</span><span class=\"selector checkable\" title=\"'+ actCheckBoxTitle +'\"></span></li>');\n\t\t\t\t$el.acldata('uri', act.uri);\n\t\t\t\tif ($el.hasClass('has-allaccess')) $('.selector', $el).click(function (e) {e.stopPropagation();Access2None($(this))});\n\t\t\t\telse $('.selector', $el).click(function (e) {e.stopPropagation();Access2All($(this))});\n\t\t\t\t//Select action\n\t\t\t\t$el.click(function() {\n\t\t\t\t\t$('#aclActions .selectable').removeClass('selected');\n\t\t\t\t\t$(this).toggleClass('selected');\n\t\t\t\t});\n\t\t\t\t$el.appendTo($('#aclActions ul.group-list'));\n\t\t\t}\n\t\t\t\n\t\t\tif (typeof successCallback !== 'undefined'){\n\t\t\t\tsuccessCallback();\n\t\t\t}\n\t\t}\n\t});\n}\n\n    function Access2All(el) {\n\t//Act\n\tvar uri = $(el).closest('li').removeClass('has-access').addClass('has-allaccess').acldata('uri');\n\tactOnUri(uri, 'add', $('#roles').val());\n\tel.unbind('click').click(function (e) {e.stopPropagation();Access2None($(this))});\n    }\n\n    function Access2None(el) {\n\t//Act\n\tvar uri = $(el).closest('li').removeClass('has-access').removeClass('has-allaccess').acldata('uri');\n\tactOnUri(uri, 'remove', $('#roles').val());\n\tel.unbind('click').click(function (e) {e.stopPropagation();Access2All($(this))});\n    }\n\nfunction actOnUri(uri, act, role) {\n  var type = uri.split('#')[1].split('_')[0];\n\tvar action = '';\n\tswitch (type) {\n\t\tcase 'e':\n\t\t\taction = 'Extension';\n\t\t\tbreak;\n\n\t\tcase 'm':\n\t\t\taction = 'Module';\n\t\t\tbreak;\n\n\t\tcase 'a':\n\t\t\taction = 'Action';\n\t\t\tbreak;\n\t}\n\tswitch (act) {\n\t\tcase 'add':\n\t\t\taction = \"add\"+action+\"Access\";\n\t\t\tbreak;\n\n\t\tcase 'remove':\n\t\t\taction = \"remove\"+action+\"Access\";\n\t\t\tbreak;\n\n\t\tcase 'mod2act':\n\t\t\taction = \"moduleTo\"+action+\"Access\";\n\t\t\tbreak;\n\n\t\tcase 'mod2acts':\n\t\t\taction = \"moduleToActionsAccess\";\n\t\t\tbreak;\n\n\t\tcase 'acts2mod':\n\t\t\taction = \"actionsToModuleAccess\";\n\t\t\tbreak;\n\t}\n\t//Do act\n\t$.ajax({\n\t\ttype: \"POST\",\n\t\turl: context.root_url + \"funcAcl/Admin/\" + action,\n\t\tdata: 'role='+role+'&uri='+uri,\n\t\tdataType: 'json',\n\t\tsuccess: function(data) {\n\t\t\t\n\t\t\tvar open = $('#aclModules .group.expendable.open').index();\n\t\t\tvar $el = $('#aclModules .selected');\n\t\t\tvar elidx;\n                        \n\t\t\tif ($el.length) {\n\t\t\t\turi = $el.acldata('uri');\n\t\t\t\telidx = $el.index();\n\t\t\t} else elidx = -1;\n\t\t\t\n\t\t\t// update GUI\n\t\t\tloadModules($('#roles').val(), function() {\n\t\t\t\t\n\t\t\t\tif (open >= 0){\n\t\t\t\t\t$('#aclModules .group.expendable:eq('+open+')').removeClass('closed')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   .addClass('open')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   .find('.group-title').addClass('open');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (elidx >= 0) {\n\t\t\t\t\t$('#aclModules .open li:eq('+elidx+')').addClass('selected');\n\t\t\t\t\tloadActions($('#roles').val(), uri);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n    }\n    \n    return {\n        start : function(){\n            //Change role\n            $('#roles').change(function() {\n                    if ($('#roles').val() === ''){\n                        $('#roleactions').hide();\n                    } else {\n                        $('#roleactions').show();\n                    }\n                    loadModules($('#roles').val());\n            }).change();\n        }\n    };\n});\n\n\n"]}