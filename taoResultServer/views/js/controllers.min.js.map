{"version":3,"file":"routes.js","sources":["routes.js","migrate.js"],"names":[],"mappings":"AAqBA,OAAA,uCAAA,WAGA,OACA,iBAEA,SACA,QAAA,0BCRA,OAAA,sCAAA,SAAA,SAAA,OAAA,UAAA,UAAA,eACA,SAAA,OAAA,EAAA,GAAA,QAAA,QAAA,UAEA,GAAA,gBACA,MAAA,WACA,EAAA,aAAA,MAEA,WAEA,GAOA,QAPA,UAAA,EAAA,MAAA,KAAA,MACA,WACA,WACA,QAAA,EAAA,cACA,QAAA,EAAA,cACA,iBAAA,EAAA,sBACA,eAAA,iBAAA,SAAA,kBAIA,eAAA,QAAA,SAAA,6CAcA,OAXA,SAAA,QACA,QAAA,QAEA,EAAA,2BAAA,KAAA,WACA,OAAA,EAAA,MAAA,MACA,QAAA,KAAA,QAEA,QACA,OAAA,EAAA,UAAA,GAAA,OAAA,QAAA,iBAAA,OACA,KAAA,EAAA,MAAA,SAAA;GAEA,QAAA,QAKA,EAAA,2BAAA,KAAA,WACA,QAAA,KAAA,EAAA,MAAA,OAEA,QAAA,OAAA,EAAA,UAAA,KAAA,EAAA,MAAA,SAAA,WAEA,QAAA,QAKA,EAAA,iBAAA,KAAA,UAAA,UAAA,YAEA,eAAA,WAAA,WAEA,kBACA,KAAA,QAAA,uBACA,QACA,OAAA,EACA,MAAA,IACA,OAAA,IACA,UAEA,GAAA,iBACA,KAAA,GAAA,UAEA,MAAA,WACA,EAAA,MAAA,OAAA,YAIA,GAAA,iBACA,KAAA,GAAA,WACA,MAAA,WACA,eAAA,OACA,iBAAA,SAAA,oBAAA,OACA,iBAAA,SAAA,sBAAA,OACA,EAAA,mBAAA,SAAA,YAAA,IAAA,SAEA,EAAA,MACA,IAAA,eACA,KAAA,OACA,SAAA,OACA,MACA,OAAA,QACA,OAAA,QACA,UAAA,WAEA,QAAA,SAAA,MAIA,GAFA,iBAAA,SAAA,sBAAA,QAEA,KAAA,QAGA,MAFA,MAAA,WACA,YAAA,MAAA,KAAA,OAIA;eAAA,SAAA,oBAAA,MAEA,IACA,IADA,IAAA,EAAA,SAAA,QAAA,iBAEA,GAAA,KAAA,KAAA,KAAA,SAAA,EAAA,QACA,GAAA,OAAA,IAAA,QAAA,iBAAA,KACA,IAAA,OAAA,EAAA,UAAA,KAAA,OAAA,WAAA,GAAA,mBACA,IAAA,OAAA,EAAA,UAAA,KAAA,OAAA,WAAA,GAAA,kBACA,IAAA,OAAA,EAAA,UAAA,KAAA,OAAA,QAAA,GAAA,gBACA,EAAA,IAAA,IAAA,SAAA,WAAA,OAAA,OAGA,EAAA,cAAA,QAAA,EAAA,SAAA,KAAA,KAAA,UACA,eAAA,OACA,EAAA,mBAAA,KAAA,GAAA,UACA,WAAA,QAAA,KAAA,SAEA,MAAA,WACA,iBAAA,SAAA,sBAAA,OACA,eAAA,oBAtEA,YAAA,MAAA,GAAA,4CAVA,YAAA,MAAA,GAAA;IAgGA,OAAA","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n * \n * \n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoResultServer/controller/routes',[],function(){\n    'use strict';\n\n    return {\n        'ResultServerMgt': {\n           // 'deps' : 'controller/migrate'\n            'actions': {\n                'migrate' : 'controller/migrate'\n            }\n            \n        }\n    };\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\r\n *\r\n *\r\n */\r\n\r\ndefine('taoResultServer/controller/migrate',['module', 'jquery','i18n', 'context', 'helpers', 'ui/feedback'], \r\n        function(module, $, __, context, helpers, feedback){\r\n    \r\n        var migrateRunner = {\r\n            start : function(options){\r\n               $('.opButton').click(\r\n                       \r\n                            function(e) {\r\n\r\n                                var operation = $(this).attr(\"id\"),\r\n                                    sources = [],\r\n                                    targets = [],\r\n                                    $source = $(\"#selSource\"),\r\n                                    $target = $(\"#selTarget\"),\r\n                                    $migrationDialog = $(\"#migrationProgress\"),\r\n                                    $migrationInfo = $migrationDialog.children(\".migrationInfo\"),\r\n                                    source;\r\n\r\n                                //todo move\r\n                                var migrateDataUrl = context.root_url+'taoResultServer/ResultServerMgt/migrateData';\r\n\r\n                                //clean any former feedback built in the dom\r\n                                $source.empty();\r\n                                $target.empty();\r\n\r\n                                $('#sourceStorage :checked').each(function() {\r\n                                    source = $(this).val();\r\n                                    sources.push(source);\r\n\r\n                                    $source\r\n                                        .append($(\"<li />\", {id: source.replace(/[^a-z0-9-_]+/ig, \"_\")})\r\n                                        .html($(this).parent().text()));\r\n                                });\r\n                                if (!sources.length) {\r\n                                  feedback().error(__('Please select a migration source'));\r\n                                  return;\r\n                                }\r\n\r\n                                $(\"#targetStorage :checked\").each(function() {\r\n                                    targets.push($(this).val());\r\n\r\n                                    $target.append($(\"<li />\").text($(this).parent().text()));\r\n                                });\r\n                                if (!targets.length) {\r\n                                  feedback().error(__(\"Please select a destination target\"));\r\n                                  return;\r\n                                }\r\n\r\n                                $(\"#selOperation\").html(\"<label>\"+operation+\"</label>\");\r\n\r\n                                $migrationInfo.children().show();\r\n\r\n                                $migrationDialog\r\n                                    .attr(\"style\", \"visibility: visible\")\r\n                                    .dialog({\r\n                                        modal: true,\r\n                                        width: 500,\r\n                                        height: 430,\r\n                                        buttons: [\r\n                                                {\r\n                                                        id: \"MigrationClose\",\r\n                                                        text: __('Cancel'),\r\n                                                        \r\n                                                        click: function() {\r\n                                                                $(this).dialog('close');\r\n                                                        }\r\n                                                },\r\n                                                {\r\n                                                        id: \"MigrationStart\",\r\n                                                        text: __('Migrate'),\r\n                                                        click: function() {\r\n                                                            $migrationInfo.hide();\r\n                                                            $migrationDialog.children(\".migrationResult\").hide();\r\n                                                            $migrationDialog.children(\".migrationProgress\").show();\r\n                                                            $(\"#MigrationStart\").addClass(\"disabled\").off(\"click\");\r\n\r\n                                                            $.ajax({\r\n                                                              url: migrateDataUrl,\r\n                                                              type: \"POST\",\r\n                                                              dataType: \"JSON\",\r\n                                                              data: {   \r\n                                                                   source: sources,\r\n                                                                   target: targets,\r\n                                                                   operation: operation\r\n                                                              },\r\n                                                              success: function(data){\r\n\r\n                                                                  $migrationDialog.children(\".migrationProgress\").hide();\r\n\r\n                                                                  if (!data.success) {\r\n                                                                      info.show();\r\n                                                                      feedback().error(data.status);\r\n                                                                      return;\r\n                                                                  }\r\n\r\n                                                                  $migrationInfo.children(\":not(#selSource)\").hide();\r\n\r\n                                                                  var $ul = $(\"<ul/>\", {class: \"StorageResult\"}),\r\n                                                                      id;\r\n                                                                  $.each(data.data, function(i, source){\r\n                                                                      id = source.uri.replace(/[^a-z0-9-_]+/ig, \"_\");\r\n                                                                      $ul.append($('<li />', {text: source.testTakers + __(\" test takers\")}));\r\n                                                                      $ul.append($('<li />', {text: source.deliveries + __(\" deliveries\")}));\r\n                                                                      $ul.append($('<li />', {text: source.callIds + __(\" call ids\")}));\r\n                                                                      $(\"#\" + id).addClass(\"success\").append($ul);\r\n                                                                  });\r\n\r\n                                                                  $(\"#selSource\").prepend($(\"<h3/>\", {text: data.status}));\r\n                                                                  $migrationInfo.show();\r\n                                                                  $(\"#MigrationClose\").text(__(\"Close\"));\r\n                                                                  feedback().success(data.status);\r\n                                                              },\r\n                                                              error : function(){\r\n                                                                  $migrationDialog.children(\".migrationProgress\").hide();\r\n                                                                  $migrationInfo.show();\r\n                                                              }\r\n                                                            });\r\n                                                            \r\n                                                            \r\n                                                        }\r\n                                                }\r\n                                        ],\r\n\r\n                                });\r\n                            }\r\n               );\r\n\r\n         }\r\n       };\r\n   \r\n        return migrateRunner;\r\n});\n"]}