{"version":3,"file":"routes.js","sources":["routes.js","admin/line!tpl","admin/index.js"],"names":[],"mappings":"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","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\n\ndefine('taoDacSimple/controller/routes',[],function(){\n    'user strict';\n    return {\n        'AdminAccessController' : {\n            'css': 'admin', \n            'actions' : {\n                'instancePermissions' : 'controller/admin/index',\n                'classPermissions' : 'controller/admin/index'\n            }\n        }\n    };\n});\n\n","\ndefine('tpl!taoDacSimple/controller/admin/line', ['handlebars'], function(Handlebars){ \nreturn Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;\n\n\n  buffer += \"<tr>\\n    <td>\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</td>\\n    <td>\\n        \";\n  if (helper = helpers.type) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.type); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\n        <input type=\\\"hidden\\\" name=\\\"users[\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"][type]\\\" value=\\\"\";\n  if (helper = helpers.type) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.type); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n    </td>\\n    <td>\\n        <label class=\\\"tooltip\\\">\\n            <input type=\\\"checkbox\\\" class=\\\"privilege-GRANT\\\" name=\\\"users[\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"][GRANT]\\\" value=\\\"1\\\">\\n            <span class=\\\"icon-checkbox\\\"></span>\\n        </label>\\n    </td>\\n    <td>\\n        <label class=\\\"tooltip\\\">\\n            <input type=\\\"checkbox\\\" class=\\\"privilege-WRITE\\\" name=\\\"users[\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"][WRITE]\\\" value=\\\"1\\\" checked>\\n            <span class=\\\"icon-checkbox\\\"></span>\\n        </label>\\n    </td>\\n    <td>\\n        <label class=\\\"tooltip\\\">\\n            <input type=\\\"checkbox\\\" class=\\\"privilege-READ\\\" name=\\\"users[\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"][READ]\\\" value=\\\"1\\\" checked>\\n            <span class=\\\"icon-checkbox\\\"></span>\\n        </label>\\n    </td>\\n    <td>\\n        <button type=\\\"button\\\" class=\\\"small delete_permission tooltip btn-link\\\" data-acl-user=\\\"\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-acl-type=\\\"\";\n  if (helper = helpers.type) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.type); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-acl-label=\\\"\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" >\\n            <span class=\\\"icon-remove\\\"></span>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove\", options) : helperMissing.call(depth0, \"__\", \"Remove\", options)))\n    + \"\\n        </button>\\n    </td>\\n</tr>\\n\";\n  return buffer;\n  });\n});\n\n","define('taoDacSimple/controller/admin/index',[\n    'jquery',\n    'i18n',\n    'tpl!taoDacSimple/controller/admin/line',\n    'helpers',\n    'ui/feedback',\n    'select2',\n    'tooltipster'\n    ], function($, __, lineTpl, helpers, feedback){\n        'use strict';\n\n        var userSelect,\n            roleSelect,\n            tooltipConfig = {\n                content : __('You must have one role or user that have the manage permission on this element.'),\n                theme : 'tao-info-tooltip',\n                trigger: 'hover'\n            } ;\n\n        /**\n         * Provide a method the deactivate UI component that provide manager deletation\n         */\n        var _preventManagerRemoval = function(){\n            var $managers = $('#permissions-table').find('.privilege-GRANT:checked'),\n                $canAccess = $managers.closest('tr').find('.privilege-WRITE'),\n                $deleteButtons = $managers.closest('tr').find('.delete_permission');\n\n            $('.tooltip').tooltipster(tooltipConfig).tooltipster('disable');\n            $managers.closest('label').tooltipster('enable');\n            $canAccess.closest('label').tooltipster('enable');\n            $deleteButtons.tooltipster('enable');\n\n\n            if($managers.length > 1){\n                $deleteButtons.removeClass(\"disabled\").tooltipster('disable');\n                $managers.removeClass('disabled').closest('label').tooltipster('disable');\n            }else{\n                $deleteButtons.addClass(\"disabled\").tooltipster('enable');\n                $canAccess.addClass('disabled').closest('label').tooltipster('enable');\n                $managers.addClass(\"disabled\").closest('label').tooltipster('enable');\n            }\n        };\n\n        /**\n         * Delete a permission row for a user/role\n         * @param  {DOM Element} element DOM element that triggered the function\n         */\n        var _deletePermission = function(element) {\n            // 1. Get the user / role\n            var $this = $(element),\n                type = $this.data('acl-type'),\n                user = $this.data('acl-user'),\n                label = $this.data('acl-label');\n\n            if( typeof type !== \"undefined\" &&\n                typeof user !== \"undefined\" &&\n                typeof label !== \"undefined\" &&\n                type !== \"\" &&\n                user !== \"\" &&\n                label !== \"\"){\n                // 2. Add it to the select & remove the line\n                switch(type){\n                    case 'user':\n                        $('#add-user').append($('<option/>',{ text : label , value : user }));\n                        $this.closest('tr').remove();\n                        break;\n                    case 'role':\n                        $('#add-role').append($('<option/>',{ text : label , value : user }));\n                        $this.closest('tr').remove();\n                        break;\n                    default:\n                        break;\n                }\n            }\n            _preventManagerRemoval();\n        };\n        /**\n         * Add a new lines into the permissions table regarding what is selected into the add-* select\n         * @param {string} type role/user regarding what it will be added.\n         */\n        var _addPermission = function(type) {\n            var $table = $('#permissions-table'),\n                body = $table.find('tbody')[0],\n                selection = [];\n            //1. Get a list of all elements to add\n            switch(type){\n                case 'user':\n                    $.each(userSelect.select2(\"data\"), function(index, val) {\n                        // Push each selected element into an array\n                        selection.push({\n                            type : 'user',\n                            user : val.id,\n                            label : val.text\n                        });\n                        // Remove them from DOM\n                        userSelect.find('option[value=\"' + val.id + '\"]').remove();\n                    });\n                    // Reset Select2 tag display\n                    userSelect.select2(\"val\",\"\");\n                    break;\n                case 'role':\n                    $.each(roleSelect.select2(\"data\"), function(index, val) {\n                        // Push each selected element into an array\n                        selection.push({\n                            type : 'role',\n                            user : val.id,\n                            label : val.text\n                        });\n                        // Remove them from DOM\n                        roleSelect.find('option[value=\"' + val.id + '\"]').remove();\n                    });\n                    // Reset Select2 tag display\n                    roleSelect.select2(\"val\",\"\");\n                    break;\n                default:\n                    break;\n            }\n            // 2. Inject them into the table\n            $.each(selection, function(index,val) {\n                $(body).append(lineTpl(val));\n            });\n        };\n        /**\n         * Allow to enable / disable the access checkbox based on the state of the grant privilege\n         */\n        var _disableAccessOnGrant = function(){\n            var $managersChecked = $('#permissions-table').find('.privilege-GRANT:checked'),\n                $cantWrite = $managersChecked.closest('tr').find('.privilege-WRITE'),\n                $cantRead = $managersChecked.closest('tr').find('.privilege-READ'),\n                $managers = $('#permissions-table').find('.privilege-GRANT').not(':checked'),\n                $canWrite = $managers.closest('tr').find('.privilege-WRITE'),\n                $canRead = $managers.closest('tr').find('.privilege-READ');\n\n            $canWrite.removeClass('disabled').closest('label').tooltipster('disable');\n            $canRead.removeClass('disabled').closest('label').tooltipster('disable');\n            $cantWrite.addClass('disabled').closest('label').tooltipster('disable');\n            $cantRead.addClass('disabled').closest('label').tooltipster('disable');\n        };\n\n\n        var mainCtrl = {\n            'start' : function(){\n\n                var $container = $('.permission-container');\n                var $form      = $('form', $container);\n                var $submiter  = $(':submit', $form);\n\n                _preventManagerRemoval();\n                _disableAccessOnGrant();\n                userSelect = $('#add-user').select2();\n                roleSelect = $('#add-role').select2();\n\n\n                /**\n                 * Listen clicks on add user button\n                 */\n                $('#add-user-btn').on('click', function(event) {\n                    event.preventDefault();\n                    _addPermission('user');\n                });\n                /**\n                 * Listen clicks on add role button\n                 */\n                $('#add-role-btn').on('click', function(event) {\n                    event.preventDefault();\n                    _addPermission('role');\n                });\n\n                /**\n                 * Ensure that if you give the manage (GRANT) permission, access (WRITE and READ) permissions are given too\n                 * &\n                 * Listen all clicks on delete buttons to call the _deletePersmission function\n                 */\n                $('#permissions-table').on('click', '.privilege-GRANT:not(.disabled) ', function() {\n                    if ($(this).is(':checked') != []) {\n                        var writeCheckbox = $(this).closest('tr').find('.privilege-WRITE').not(':checked')[0];\n                        var readCheckbox = $(this).closest('tr').find('.privilege-READ').not(':checked')[0];\n                        $(writeCheckbox).click();\n                        $(readCheckbox).click();\n                    }\n                    _preventManagerRemoval();\n                    _disableAccessOnGrant();\n                }).on('click', '.delete_permission:not(.disabled)', function(event) {\n                    event.preventDefault();\n                    _deletePermission(this);\n                });\n                \n                $form.on('submit', function(e){\n                    e.preventDefault();\n                    e.stopImmediatePropagation();\n                });\n                $submiter.on('click', function(e){\n                    e.preventDefault();\n\n                    $submiter.addClass('disabled');\n\n                    $.post($form.attr('action'), $form.serialize())\n                        .done(function(res){\n                            if(res && res.success){\n                                feedback().success(__(\"Permissions saved\"));\n                            } else {\n                                feedback().error(__(\"Something went wrong...\"));\n                            }\n                        })\n                        .complete(function(){\n                            $submiter.removeClass('disabled');\n                        });\n                });\n            }\n        };\n\n        return mainCtrl;\n    })\n;\n"]}